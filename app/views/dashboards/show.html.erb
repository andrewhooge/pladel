<% provide(:title, 'Dashboard') %>
<div id="fixedBG"></div>
<div class="dashboard">
  <%= render 'shared/modal' %>

  <div class="letter overall"><%= current_user.health_gpa %></div>

  <div class="dataTime">
    <a href="#">DAY</a>
    <a href="#">WEEK</a>
    <a href="#">MONTH</a>
    <a href="#">YEAR</a>
  </div>

  <div id="doughnutChart" class="chart"></div>

  <% unless sleep_composite_empty?(current_user) %>
    <div class="sleep tooltip-item">
      <p class="sleep-percentage">Sleep: <%= "#{(current_user.sleep_composite / 0.30).round}%" %></p>
      <div class="tooltip">
        <p>Your sleep score is calculated by the amount of sleep and quality. It is calculated daily, weekly and all time. You can toggle between daily, weekly, monthly and all time by clicking on the buttons below the chart.</p>
      </div>
    </div>
  <% end %>

  <% unless movement_composite_empty?(current_user) %>
    <div class="movement tooltip-item">
      <p class="movement-percentage">Movement: <%= "#{(current_user.movement_composite / 100).round}%" %></p>
      <div class="tooltip">
        <p>Your movement score is calculated by the amount of movement and intensity. It is calculated daily, weekly and all time. You can toggle between daily, weekly, monthly and all time by clicking on the buttons below the chart.</p>
      </div>
    </div>
  <% end %>

  <% unless composite_percent(current_user) == 0 %>
    <div class="nutrition tooltip-item">
      <p class="nutrition-percentage">Nutrition: <%= "#{composite_percent(current_user)}%" %></p>
      <div class="tooltip">
        <p>Your nutrition score is calculated by the percentage of meals eaten daily, weekly and all time. You can toggle between daily, weekly, monthly and all time by clicking on the buttons below the chart.</p>
      </div>
    </div>
  <% end %>

  <%= link_to 'Sync data', sessions_path %>

  <p>
    Meals logged: <span class="meal-logging"><%= current_user.meals.count - 1 %></span>
  </p>

  <div class="meal-reporting">
    <div class="meals tooltip-item">
        <div class="daily_meal">
          <img src="http://i.imgur.com/HWk1OSI.png">
        </div>
        <div class="checked animated tada">
          <%= image_tag 'check.png' %>
        </div>
        <div class="closed animated tada">
          <%= image_tag 'close.png' %>
        </div>
        <div class="tooltip">
          <p>To report and track your meals you can click on each meal icon and select complete or incomplete. The meals will highlight when reported and you will see new empty icons appear in case you need to add another meal.</p>
      </div>
    </div>

    <div class="meal_buttons">
      <%= button_to 'I ate healthy', meal_path(current_user.meals.last), method: :patch, id: 'checkButton', remote: true %></li>
      <%= button_to 'I ate poorly', meal_path(current_user.meals.last), method: :delete, id: 'xButton', remote: true %> </li>
    </div>
  </div>
</div>

  <script>
$(function(){
  $("#doughnutChart").drawDoughnutChart([
    { title: "Overall GPA",         value : <%= ((current_user.sleep_composite / 0.3).round + (current_user.movement_composite / 100).round + composite_percent(current_user)) / health_gpa_percent_denominator(current_user) %>,  color: "#75C9BC" },
    { title: "Room for improvement", value:  100 - <%= ((current_user.sleep_composite / 0.3).round + (current_user.movement_composite / 100).round + composite_percent(current_user)) / health_gpa_percent_denominator(current_user) %>,   color: "#585858" },
  ]);
});
  </script>
